{"version":3,"file":"Layer-Video-Switcher.jsx","sources":["../../src/polyfill/array/forEach.js","../../src/utils/System/pref.ts","../../src/projects/LayerVideoSwitcher/ui.ts","../../node_modules/json-format/index.js","../../src/polyfill/array/some.js","../../src/utils/Javascript/general.ts","../../src/utils/typeCheck.ts","../../src/utils/GetEntity/getEntity.ts","../../src/utils/GetEntity/getSelectedEntity.ts","../../src/utils/GetEntity/getEntityPath.ts","../../src/projects/LayerVideoSwitcher/utils.ts","../../src/projects/LayerVideoSwitcher/index.ts"],"sourcesContent":["/*\n * forEach Polyfill\n *\n * 2015-12-27\n *\n * By Feifei Hang, http://feifeihang.info\n * Public Domain.\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n */\n\"use strict\";\n(function() {\n  if (!Array.prototype.forEach) {\n    Array.prototype.forEach = function forEach(callback, thisArg) {\n      if (typeof callback !== \"function\") {\n        throw new TypeError(callback + \" is not a function\");\n      }\n      var array = this;\n      thisArg = thisArg || this;\n      for (var i = 0, l = array.length; i !== l; ++i) {\n        callback.call(thisArg, array[i], i, array);\n      }\n    };\n  }\n})();\n","// Allow Scripts to Write Files and Access Network\nconst isSecurityPrefSet = (): boolean => {\n  const securitySetting = app.preferences.getPrefAsLong(\n    \"Main Pref Section\",\n    \"Pref_SCRIPTING_FILE_NETWORK_SECURITY\"\n  );\n  return securitySetting === 1;\n};\n\nexport default {\n  isSecurityPrefSet\n};\n","import globalThis from \"globalThis\";\n\nexport const dialog: Panel = globalThis;\n\n// DIALOG\n// ======\ndialog.text = \"Add-Comment\";\ndialog.orientation = \"column\";\ndialog.alignChildren = [\"left\", \"top\"];\ndialog.spacing = 10;\ndialog.margins = 16;\n\n// fileDialogButtonGroup\n// ======\nexport const fileDialogButtonGroup = dialog.add(\"group\", undefined, {\n  name: \"fileDialogButtonGroup\"\n});\nfileDialogButtonGroup.orientation = \"row\";\nfileDialogButtonGroup.alignChildren = [\"left\", \"center\"];\nfileDialogButtonGroup.spacing = 10;\nfileDialogButtonGroup.margins = 0;\n\nexport const importButton = fileDialogButtonGroup.add(\n  \"button\",\n  undefined,\n  undefined,\n  {\n    name: \"importButton\"\n  }\n);\nimportButton.text = \"import\";\n\nexport const newButton = fileDialogButtonGroup.add(\n  \"button\",\n  undefined,\n  undefined,\n  {\n    name: \"newButton\"\n  }\n);\nnewButton.text = \"new\";\n\nexport const pathInput = dialog.add(\"edittext\", undefined, undefined, {\n  name: \"numInput\"\n});\npathInput.text = \"\";\n(pathInput.preferredSize as Dimension).width = 240;\n\n// fileNameGroup\n// ======\nexport const fileNameGroup = dialog.add(\"group\", undefined, {\n  name: \"fileNameGroup\"\n});\nfileNameGroup.orientation = \"row\";\nfileNameGroup.alignChildren = [\"left\", \"center\"];\nfileNameGroup.spacing = 10;\nfileNameGroup.margins = 0;\n\nexport const fileNameInput = fileNameGroup.add(\n  \"edittext\",\n  undefined,\n  undefined,\n  {\n    name: \"fileName\"\n  }\n);\nfileNameInput.text = \"\";\n(fileNameInput.preferredSize as Dimension).width = 160;\n\nexport const extensionText = fileNameGroup.add(\n  \"statictext\",\n  undefined,\n  undefined,\n  {\n    name: \"extensionText\"\n  }\n);\nextensionText.text = \".json\";\n\n// optionGroup\n// ======\nexport const optionGroup = dialog.add(\"group\", undefined, {\n  name: \"optionGroup\"\n});\noptionGroup.orientation = \"row\";\noptionGroup.alignChildren = [\"left\", \"center\"];\noptionGroup.spacing = 10;\noptionGroup.margins = 0;\n\nexport const invertCheck = optionGroup.add(\"checkbox\", undefined, undefined, {\n  name: \"invertCheck\"\n});\ninvertCheck.text = \"invert\";\n\nexport const toggleCheck = optionGroup.add(\"checkbox\", undefined, undefined, {\n  name: \"toggleCheck\"\n});\ntoggleCheck.text = \"toggle\";\n\n// buttonGroup\n// ======\nexport const buttonGroup = dialog.add(\"group\", undefined, {\n  name: \"buttonGroup\"\n});\nbuttonGroup.orientation = \"row\";\nbuttonGroup.alignChildren = [\"left\", \"center\"];\nbuttonGroup.spacing = 10;\nbuttonGroup.margins = 0;\n\nexport const addButton = buttonGroup.add(\"button\", undefined, undefined, {\n  name: \"addButton\"\n});\naddButton.text = \"add\";\n\nexport const switchButton = buttonGroup.add(\"button\", undefined, undefined, {\n  name: \"switchButton\"\n});\nswitchButton.text = \"switch\";\n","/*\n  change for npm modules.\n  by Luiz Est√°cio.\n\n  json-format v.1.1\n  http://github.com/phoboslab/json-format\n\n  Released under MIT license:\n  http://www.opensource.org/licenses/mit-license.php\n*/\nvar p = [],\n  indentConfig = {\n    tab: { char: '\\t', size: 1 },\n    space: { char: ' ', size: 4 }\n  },\n  configDefault = {\n    type: 'tab'\n  },\n  push = function( m ) { return '\\\\' + p.push( m ) + '\\\\'; },\n  pop = function( m, i ) { return p[i-1] },\n  tabs = function( count, indentType) { return new Array( count + 1 ).join( indentType ); };\n\nfunction JSONFormat ( json, indentType ) {\n  p = [];\n  var out = \"\",\n      indent = 0;\n\n  // Extract backslashes and strings\n  json = json\n    .replace( /\\\\./g, push )\n    .replace( /(\".*?\"|'.*?')/g, push )\n    .replace( /\\s+/, '' );    \n\n  // Indent and insert newlines\n  for( var i = 0; i < json.length; i++ ) {\n    var c = json.charAt(i);\n\n    switch(c) {\n      case '{':\n      case '[':\n        out += c + \"\\n\" + tabs(++indent, indentType);\n        break;\n      case '}':\n      case ']':\n        out += \"\\n\" + tabs(--indent, indentType) + c;\n        break;\n      case ',':\n        out += \",\\n\" + tabs(indent, indentType);\n        break;\n      case ':':\n        out += \": \";\n        break;\n      default:\n        out += c;\n        break;      \n    }         \n  }\n\n  // Strip whitespace from numeric arrays and put backslashes \n  // and strings back in\n  out = out\n    .replace( /\\[[\\d,\\s]+?\\]/g, function(m){ return m.replace(/\\s/g,''); } )\n    .replace( /\\\\(\\d+)\\\\/g, pop ) // strings\n    .replace( /\\\\(\\d+)\\\\/g, pop ); // backslashes in strings\n\n  return out;\n};\n\nmodule.exports = function(json, config){\n  config = config || configDefault;\n  var indent = indentConfig[config.type];\n\n  if ( indent == null ) {\n    throw new Error('Unrecognized indent type: \"' + config.type + '\"');\n  }\n  var indentType = new Array((config.size || indent.size) + 1).join(indent.char);\n  return JSONFormat(JSON.stringify(json), indentType);\n}\n","// Production steps of ECMA-262, Edition 5, 15.4.4.17\n// Reference: http://es5.github.io/#x15.4.4.17\nif (!Array.prototype.some) {\n  Array.prototype.some = function(fun, thisArg) {\n    \"use strict\";\n\n    if (this == null) {\n      throw new TypeError(\"Array.prototype.some called on null or undefined\");\n    }\n\n    if (typeof fun !== \"function\") {\n      throw new TypeError();\n    }\n\n    var t = Object(this);\n    var len = t.length >>> 0;\n\n    var thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n    for (var i = 0; i < len; i++) {\n      if (i in t && fun.call(thisArg, t[i], i, t)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n}\n","import {\n  isCompItem,\n  isFolderItem,\n  isFootageItem,\n  isAVLayer,\n  isFileSource,\n  isSolidSource,\n  isProperty,\n  isPropertyGroup,\n  isObject\n} from \"../typeCheck\";\n\nexport const times = (\n  step: number,\n  callback: (index: number) => boolean | null | undefined | void,\n  reverse: boolean = false\n): void => {\n  if (reverse) {\n    for (let i = step; i > 0; i--) {\n      if (callback(i)) {\n        break;\n      } else {\n        continue;\n      }\n    }\n  } else {\n    for (let i = 1; i <= step; i++) {\n      if (callback(i)) {\n        break;\n      } else {\n        continue;\n      }\n    }\n  }\n};\n\nexport const setTimeout = (callback: () => void, time: number) => {\n  $.sleep(time);\n  callback();\n};\n\nexport const computeDurationWithMsec = (ms: number): string => {\n  const h = parseInt(String(Math.floor(ms / 3600000) + 100).substring(1));\n  const m = parseInt(\n    String(Math.floor((ms - h * 3600000) / 60000) + 100).substring(1)\n  );\n  const s = parseInt(\n    String(Math.round((ms - h * 3600000 - m * 60000) / 1000) + 100).substring(1)\n  );\n  return h + \":\" + m + \":\" + s;\n};\n","export const isFolderItem = (item: any): item is FolderItem => {\n  return item instanceof FolderItem;\n};\n\nexport const isCompItem = (item: any): item is CompItem => {\n  return item instanceof CompItem;\n};\n\nexport const isFootageItem = (item: any): item is FootageItem => {\n  return item instanceof FootageItem;\n};\n\nexport const isAVItem = (item: any): item is CompItem | FootageItem => {\n  return isCompItem(item) || isFootageItem(item);\n};\n\nexport const isAnyItem = (item: any): item is $T.ADBE.AnyItem => {\n  return isCompItem(item) || isFolderItem(item) || isFootageItem(item);\n};\n\nexport const isAVLayer = (layer: any): layer is AVLayer => {\n  return layer instanceof AVLayer;\n};\n\nexport const isCameraLayer = (layer: any): layer is CameraLayer => {\n  return layer instanceof CameraLayer;\n};\n\nexport const isLightLayer = (layer: any): layer is LightLayer => {\n  return layer instanceof LightLayer;\n};\n\nexport const isShapeLayer = (layer: any): layer is ShapeLayer => {\n  return layer instanceof ShapeLayer;\n};\n\nexport const isTextLayer = (layer: any): layer is TextLayer => {\n  return layer instanceof TextLayer;\n};\n\nexport const isAnyLayer = (layer: any): layer is $T.ADBE.AnyLayer => {\n  return (\n    isAVLayer(layer) ||\n    isCameraLayer(layer) ||\n    isLightLayer(layer) ||\n    isShapeLayer(layer) ||\n    isTextLayer(layer)\n  );\n};\n\nexport const isFileSource = (source: any): source is FileSource => {\n  return source instanceof FileSource;\n};\n\nexport const isSolidSource = (source: any): source is SolidSource => {\n  return source instanceof SolidSource;\n};\n\nexport const isPlaceholderSource = (\n  source: any\n): source is PlaceholderSource => {\n  return source instanceof PlaceholderSource;\n};\n\nexport const isAnySource = (\n  source: any\n): source is FileSource | SolidSource | PlaceholderSource => {\n  return (\n    isFileSource(source) || isSolidSource(source) || isPlaceholderSource(source)\n  );\n};\n\nexport const isProperty = (property: any): property is Property => {\n  return property instanceof Property;\n};\n\nexport const isPropertyGroup = (property: any): property is PropertyGroup => {\n  return property instanceof PropertyGroup;\n};\n\nexport const isMaskPropertyGroup = (\n  property: any\n): property is MaskPropertyGroup => {\n  return property instanceof MaskPropertyGroup;\n};\n\nexport const isAnyProperty = (\n  property: any\n): property is $T.ADBE.AnyProperty => {\n  return (\n    isProperty(property) ||\n    isPropertyGroup(property) ||\n    isMaskPropertyGroup(property)\n  );\n};\n\nexport const isTextDocument = (value: any): value is TextDocument => {\n  return value instanceof TextDocument;\n};\n\nexport const isShape = (value: any): value is Shape => {\n  return value instanceof Shape;\n};\n\nexport const isMarkerValue = (value: any): value is MarkerValue => {\n  return value instanceof MarkerValue;\n};\n\nexport const isBasicPropertyValue = (\n  value: any\n): value is $T.Mat.BasicValue => {\n  const isBasicPropertyArray =\n    isArray(value) &&\n    ((value.length === 2 && isNumber(value[0]) && isNumber(value[1])) ||\n      (value.length === 3 &&\n        isNumber(value[0]) &&\n        isNumber(value[1]) &&\n        isNumber(value[2])) ||\n      (value.length === 4 &&\n        isNumber(value[0]) &&\n        isNumber(value[1]) &&\n        isNumber(value[2]) &&\n        isNumber(value[3])));\n  return (\n    isUndefined(value) ||\n    isBoolean(value) ||\n    isNumber(value) ||\n    isBasicPropertyArray\n  );\n};\n\nexport const isPropertyValue = (value: any): value is PropertyValue => {\n  return (\n    isTextDocument(value) ||\n    isShape(value) ||\n    isMarkerValue(value) ||\n    isBasicPropertyValue(value)\n  );\n};\n\nexport const isObject = (data: any): data is { [key: string]: any } => {\n  return Object.prototype.toString.call(data) === \"[object Object]\";\n};\n\nexport const isArray = (data: any): data is any[] => {\n  return Array.isArray(data);\n};\n\nexport const isFunction = (data: any): data is Function => {\n  return typeof data === \"function\";\n};\n\nconst posinf = Number.POSITIVE_INFINITY;\nconst neginf = Number.NEGATIVE_INFINITY;\n\nexport const isNumber = (data: any): data is number => {\n  return typeof data === \"number\" && data > neginf && data < posinf;\n};\n\nexport const isUndefined = (data: any): data is undefined => {\n  return data === undefined;\n};\n\nexport const isBoolean = (data: any): data is Boolean => {\n  return data === false || data === true;\n};\n\nexport const isString = (data: any): data is string => {\n  return typeof data === \"string\";\n};\n\nexport const isCompItems = (items: any): items is CompItem[] => {\n  return items.every(isCompItem);\n};\n","import \"../../polyfill/array/some\";\nimport { __Error__ } from \"../initialize\";\nimport { times } from \"../Javascript/general\";\nimport {\n  isCompItem,\n  isFolderItem,\n  isFootageItem,\n  isAVLayer,\n  isFileSource,\n  isSolidSource,\n  isProperty,\n  isPropertyGroup,\n  isObject,\n  isAnyLayer,\n  isAnyProperty,\n  isMaskPropertyGroup,\n  isAnyItem,\n  isTextLayer,\n  isShapeLayer\n} from \"../typeCheck\";\nimport {} from \"../System/fileSys\";\n\nexport const getActiveItem = (): $T.ADBE.AnyItem | null => {\n  const item = app.project.activeItem;\n  return (item as $T.ADBE.AnyItem) || null;\n};\n\nexport const getActiveCompItem = (): CompItem | null => {\n  const item = getActiveItem();\n  return item instanceof CompItem ? item : null;\n};\n\nexport const getChildItems = (\n  folder: FolderItem = app.project.rootFolder,\n  callback?: (item: $T.ADBE.AnyItem) => boolean\n): $T.ADBE.AnyItem[] => {\n  const items: $T.ADBE.AnyItem[] = [];\n  times(folder.numItems, index => {\n    const item = folder.item(index) as $T.ADBE.AnyItem;\n    if (callback && !callback(item)) return;\n    items.push(item);\n  });\n  return items;\n};\n\nexport const getChildItem = (\n  folder: FolderItem = app.project.rootFolder,\n  callback: (item: $T.ADBE.AnyItem) => boolean\n): $T.ADBE.AnyItem | null => {\n  let item: $T.ADBE.AnyItem | null = null;\n  times(folder.numItems, index => {\n    const target = folder.item(index) as $T.ADBE.AnyItem;\n    if (callback && !callback(target)) return;\n    item = target;\n    return true;\n  });\n  return item;\n};\n\nexport const findItemWithName = (\n  name: string,\n  parent: FolderItem = app.project.rootFolder\n): $T.ADBE.AnyItem | null => {\n  let item: $T.ADBE.AnyItem | null = null;\n  getChildItems(parent).some(current => {\n    if (current.name === name) {\n      item = current;\n      return true;\n    }\n    return false;\n  });\n  return item;\n};\n\nexport const findFolderItemWithName = (\n  name: string,\n  parent: FolderItem = app.project.rootFolder\n): FolderItem | null => {\n  const item = findItemWithName(name, parent);\n  if (!isFolderItem(item)) {\n    __Error__(\n      $.line,\n      `findFolderItemWithName / not found FolderItem / name: ${name} / parent: ${\n        parent.name\n      } / item: ${item ? item.name : \"null\"}`\n    );\n    return null;\n  }\n  return item;\n};\n\nexport const findCompItemWithName = (\n  name: string,\n  parent: FolderItem = app.project.rootFolder\n): CompItem | null => {\n  const item = findItemWithName(name, parent);\n  if (!isCompItem(item)) {\n    __Error__(\n      $.line,\n      `findCompItemWithName / not found CompItem / name: ${name} / parent: ${\n        parent.name\n      } / item: ${item ? item.name : \"null\"}`\n    );\n    return null;\n  }\n  return item;\n};\n\nexport const findFootageItemWithName = (\n  name: string,\n  parent: FolderItem = app.project.rootFolder\n): FootageItem | null => {\n  const item = findItemWithName(name, parent);\n  if (!isFootageItem(item)) {\n    __Error__(\n      $.line,\n      `findFootageItemWithName / not found FootageItem / name: ${name} / parent: ${\n        parent.name\n      } / item: ${item ? item.name : \"null\"}`\n    );\n    return null;\n  }\n  return item;\n};\n\nexport const findLayerWithName = (\n  name: string,\n  comp: CompItem\n): $T.ADBE.AnyLayer | null => {\n  const layer = comp.layer(name) as $T.ADBE.AnyLayer | null;\n  return layer ? layer : null;\n};\n\nexport const findAVLayerWithName = (\n  name: string,\n  comp: CompItem\n): AVLayer | null => {\n  const layer = findLayerWithName(name, comp);\n  if (!isAVLayer(layer)) {\n    __Error__(\n      $.line,\n      `findAVLayerWithName / not found AVLayer / name: ${name} / comp: ${\n        comp.name\n      } / layer: ${layer ? layer.name : \"null\"}`\n    );\n    return null;\n  }\n  return layer;\n};\n\nexport const findTextLayerWithName = (\n  name: string,\n  comp: CompItem\n): TextLayer | null => {\n  const layer = findLayerWithName(name, comp);\n  if (!isTextLayer(layer)) {\n    __Error__(\n      $.line,\n      `findTextLayerWithName / not found TextLayer / name: ${name} / comp: ${\n        comp.name\n      } / layer: ${layer ? layer.name : \"null\"}`\n    );\n    return null;\n  }\n  return layer;\n};\n\nexport const findPropertyWithName = (\n  name: string,\n  parent: $T.ADBE.AnyLayer | PropertyGroup | MaskPropertyGroup\n): $T.ADBE.AnyProperty | null => {\n  const property = parent.property(name) as $T.ADBE.AnyProperty | null;\n  return property ? property : null;\n};\n\nexport const getLayers = (\n  comp: CompItem,\n  options: {\n    fromBottom?: boolean;\n    callback?: (layer: $T.ADBE.AnyLayer) => boolean;\n  } = {}\n): $T.ADBE.AnyLayer[] => {\n  const layers: $T.ADBE.AnyLayer[] = [];\n  times(comp.numLayers, index => {\n    const layer = comp.layer(index) as $T.ADBE.AnyLayer;\n    if (options.callback && options.callback(layer)) return;\n    layers.push(layer);\n  });\n  return options.fromBottom ? layers.reverse() : layers;\n};\n\nexport const getAllItems = (callback?: (item: $T.ADBE.AnyItem) => boolean) => {\n  const items: $T.ADBE.AnyItem[] = [];\n  times(app.project.numItems, i => {\n    const item = app.project.item(i) as $T.ADBE.AnyItem;\n    if (callback && callback(item)) return;\n    items.push(item);\n  });\n  return items;\n};\n","import { getActiveItem, getActiveCompItem } from \"./getEntity\";\n\nexport const getSelectedItems = (): $T.ADBE.AnyItem[] | null => {\n  const items = app.project.selection;\n  return items[0] ? (items as $T.ADBE.AnyItem[]) : null;\n};\n\nexport const getSelectedLayers = (\n  compItem: CompItem\n): $T.ADBE.AnyLayer[] | null => {\n  const layers = compItem.selectedLayers as $T.ADBE.AnyLayer[];\n  return layers[0] ? layers : null;\n};\n\nexport const getSelectedProperties = (\n  compItem: CompItem\n): $T.ADBE.AnyProperty[] | null => {\n  const properties = compItem.selectedProperties as\n    | $T.ADBE.AnyProperty[]\n    | null;\n  return properties && properties[0] ? properties : null;\n};\n\nexport const getSelectedPropertiesFromActive = ():\n  | $T.ADBE.AnyProperty[]\n  | null => {\n  const compItem = getActiveCompItem();\n  return compItem && getSelectedProperties(compItem);\n};\n\nexport const getSelectedLayersFromActive = (): $T.ADBE.AnyLayer[] | null => {\n  const compItem = getActiveCompItem();\n  return compItem && getSelectedLayers(compItem);\n};\n","import {} from \"./getEntity\";\nimport {} from \"./getSelectedEntity\";\nimport {} from \"../item\";\nimport {} from \"../typeCheck\";\nimport {} from \"../System/fileSys\";\n\n// e.g. return [innerFolder, parentFolder]\nexport const getItemAncestors = (\n  item: Item,\n  callback: (item: FolderItem) => void,\n  root: FolderItem = app.project.rootFolder\n): null => {\n  const parent = item.parentFolder;\n  if (parent === root || parent === app.project.rootFolder) {\n    return null;\n  } else {\n    callback(parent);\n    return getItemAncestors(parent, callback, root);\n  }\n};\n\nexport type LayerPath = string[];\nexport const getLayerPath = (\n  item: CompItem,\n  layer: $T.ADBE.AnyLayer\n): LayerPath | null => {\n  const ancestors: string[] = [];\n  getItemAncestors(item, parent => {\n    ancestors.push(parent.name);\n  });\n  if (!ancestors) {\n    return null;\n  }\n\n  const path: LayerPath = [layer.name, item.name, ...ancestors];\n  return path;\n};\n","import { getActiveCompItem } from \"../../utils/GetEntity/getEntity\";\nimport { getSelectedLayersFromActive } from \"../../utils/GetEntity/getSelectedEntity\";\nimport { getLayerPath, LayerPath } from \"../../utils/GetEntity/getEntityPath\";\nimport {\n  findItemWithName,\n  findLayerWithName\n} from \"../../utils/GetEntity/getEntity\";\nimport { isCompItem, isFolderItem, isCompItems } from \"../../utils/typeCheck\";\nimport { times } from \"../../utils/Javascript/general\";\n\nexport type Switch = { enabled: boolean; path: LayerPath };\nexport type SwitchList = Switch[];\nexport const getLayersSwitcher = (): SwitchList | undefined => {\n  const activeItem = getActiveCompItem();\n  const layers = getSelectedLayersFromActive();\n  if (!activeItem || !layers || !layers[0]) {\n    alert(\"Please select a layer.\");\n    return;\n  }\n\n  let layerPathList: SwitchList = [];\n\n  layers.forEach((layer, i) => {\n    if (!layer.hasVideo) {\n      return;\n    }\n    const arrayPath = getLayerPath(activeItem, layer);\n    if (!arrayPath) {\n      return;\n    }\n    layerPathList.push({ enabled: layer.enabled, path: arrayPath });\n  });\n\n  return layerPathList;\n};\n\nexport const getLayerFromPath = (path: LayerPath): Layer | null => {\n  let parent: FolderItem = app.project.rootFolder;\n  let comp: CompItem | null = null;\n  let layer: Layer | null = null;\n  times(\n    path.length,\n    i => {\n      let item: $T.ADBE.AnyItem | null = null;\n      if (i === 1) {\n        if (!comp) {\n          return true;\n        }\n        layer = findLayerWithName(path[i - 1], comp);\n        return true;\n      }\n\n      item = findItemWithName(path[i - 1], parent);\n\n      if (i === 2) {\n        if (!isCompItem(item)) {\n          return true;\n        }\n        comp = item;\n        return;\n      }\n\n      if (item) {\n        if (!isFolderItem(item)) {\n          return true;\n        }\n        parent = item;\n        return;\n      }\n      return true;\n    },\n    true\n  );\n  return layer;\n};\n","import \"../../polyfill/array/forEach\";\nimport pref from \"../../utils/System/pref\";\nimport * as win from \"./ui\";\nimport jsonFormat from \"json-format\";\n\nimport { getSelectedItems } from \"../../utils/GetEntity/getSelectedEntity\";\nimport { unselectAllItems } from \"../../utils/item\";\nimport { LayerPath } from \"../../utils/GetEntity/getEntityPath\";\nimport { getLayersSwitcher, SwitchList, getLayerFromPath } from \"./utils\";\nimport { times } from \"../../utils/Javascript/general\";\n\ntype JsonObjType = {\n  name?: string;\n  switchList: SwitchList;\n};\n\nconst insertFileInput = (file: File) => {\n  if (!file) return;\n  file.encoding = \"utf-8\";\n  file.lineFeed = \"Unix\";\n\n  const fileName = file.name\n    .split(\".\")\n    .slice(0, -1)\n    .join(\".\");\n\n  win.pathInput.text = file.path;\n  win.fileNameInput.text = fileName;\n};\n\nconst main = () => {\n  if (!pref.isSecurityPrefSet()) {\n    alert(\n      \"You need to allow the script to write files and access the network.\"\n    );\n  }\n\n  win.importButton.onClick = () => {\n    const file = File.openDialog(\"Import\", \"*.json\");\n    insertFileInput(file);\n  };\n\n  win.newButton.onClick = () => {\n    const file = File.saveDialog(\"Save\", \"*.json\");\n    insertFileInput(file);\n  };\n\n  win.addButton.onClick = () => {\n    if (!win.pathInput.text || !win.fileNameInput.text) {\n      alert(\"Please specify the file.\");\n      return;\n    }\n\n    const file = new File(\n      win.pathInput.text + \"/\" + win.fileNameInput.text + \".json\"\n    );\n    file.encoding = \"utf-8\";\n    file.lineFeed = \"Unix\";\n\n    file.open(\"r\");\n    const content = file.read();\n    file.close();\n\n    let jsonObj: JsonObjType = { switchList: [] };\n    if (content) {\n      try {\n        jsonObj = JSON.parse(content) as JsonObjType;\n      } catch (e) {\n        alert(e);\n        return;\n      }\n    }\n\n    const newLayersSwitcher = getLayersSwitcher();\n    if (!newLayersSwitcher) {\n      return;\n    }\n\n    jsonObj.switchList = jsonObj.switchList.concat(newLayersSwitcher);\n\n    const parentFolder = file.parent;\n    if (!parentFolder.exists) {\n      alert(\"There is no parent folder.\");\n      return;\n    }\n\n    let result = true;\n    file.open(\"w\");\n    result = file.write(jsonFormat(jsonObj));\n    file.close();\n\n    if (result) {\n    } else {\n      alert(\"It was not saved correctly.\");\n    }\n  };\n\n  win.switchButton.onClick = () => {\n    if (!win.pathInput.text || !win.fileNameInput.text) {\n      alert(\"Please specify the file.\");\n      return;\n    }\n\n    const file = new File(\n      win.pathInput.text + \"/\" + win.fileNameInput.text + \".json\"\n    );\n    file.encoding = \"utf-8\";\n    file.lineFeed = \"Unix\";\n\n    file.open(\"r\");\n    const content = file.read();\n    file.close();\n\n    let jsonObj: JsonObjType = { switchList: [] };\n    if (content) {\n      try {\n        jsonObj = JSON.parse(content) as JsonObjType;\n      } catch (e) {\n        alert(e);\n        return;\n      }\n    } else {\n      alert(\"The file does not exist.\");\n    }\n\n    jsonObj.switchList.forEach((layerSwitch, i) => {\n      const layer = getLayerFromPath(layerSwitch.path);\n      if (!layer) {\n        return;\n      }\n\n      if (win.toggleCheck.value) {\n        layer.enabled = !layer.enabled;\n      } else {\n        if (win.invertCheck.value) {\n          layer.enabled = !layerSwitch.enabled;\n        } else {\n          layer.enabled = layerSwitch.enabled;\n        }\n      }\n    });\n  };\n\n  // ======\n  win.dialog.layout.layout();\n  win.dialog.layout.resize();\n};\n\nmain();\n"],"names":["Array","prototype","forEach","callback","thisArg","TypeError","array","i","l","length","call","isSecurityPrefSet","securitySetting","app","preferences","getPrefAsLong","dialog","globalThis","text","orientation","alignChildren","spacing","margins","fileDialogButtonGroup","add","undefined","name","importButton","newButton","pathInput","preferredSize","width","fileNameGroup","fileNameInput","extensionText","optionGroup","invertCheck","toggleCheck","buttonGroup","addButton","switchButton","p","indentConfig","tab","size","space","configDefault","type","push","m","pop","tabs","count","indentType","join","JSONFormat","json","out","indent","replace","c","charAt","config","Error","JSON","stringify","some","fun","t","Object","len","arguments","times","step","reverse","isFolderItem","item","FolderItem","isCompItem","CompItem","getActiveItem","project","activeItem","getActiveCompItem","getChildItems","folder","rootFolder","items","numItems","index","findItemWithName","parent","current","findLayerWithName","comp","layer","getSelectedLayers","compItem","layers","selectedLayers","getSelectedLayersFromActive","getItemAncestors","root","parentFolder","getLayerPath","ancestors","path","getLayersSwitcher","alert","layerPathList","hasVideo","arrayPath","enabled","getLayerFromPath","insertFileInput","file","encoding","lineFeed","fileName","split","slice","win","main","pref","onClick","File","openDialog","saveDialog","open","content","read","close","jsonObj","switchList","parse","e","newLayersSwitcher","concat","exists","result","write","jsonFormat","layerSwitch","value","layout","resize"],"mappings":"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"}