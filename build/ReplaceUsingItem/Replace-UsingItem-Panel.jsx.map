{"version":3,"file":"Replace-UsingItem-Panel.jsx","sources":["../../src/polyfill/array/forEach.js","../../src/projects/ReplaceUsingItem/ui.ts","../../src/utils/Javascript/general.ts","../../src/utils/typeCheck.ts","../../src/utils/GetEntity/getSelectedEntity.ts","../../src/projects/ReplaceUsingItem/index.ts"],"sourcesContent":["/*\n * forEach Polyfill\n *\n * 2015-12-27\n *\n * By Feifei Hang, http://feifeihang.info\n * Public Domain.\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n */\n\"use strict\";\n(function() {\n  if (!Array.prototype.forEach) {\n    Array.prototype.forEach = function forEach(callback, thisArg) {\n      if (typeof callback !== \"function\") {\n        throw new TypeError(callback + \" is not a function\");\n      }\n      var array = this;\n      thisArg = thisArg || this;\n      for (var i = 0, l = array.length; i !== l; ++i) {\n        callback.call(thisArg, array[i], i, array);\n      }\n    };\n  }\n})();\n","import globalThis from \"globalThis\";\n\nexport const dialog: Panel = globalThis;\n\n// DIALOG\n// ======\ndialog.text = \"Replace-UsingItem\";\ndialog.orientation = \"column\";\ndialog.alignChildren = [\"left\", \"top\"];\ndialog.spacing = 10;\ndialog.margins = 16;\n\n// DIALOG\n// ======\nexport const setButton = dialog.add(\"button\", undefined, undefined, {\n  name: \"setButton\"\n});\nsetButton.text = \"set source\";\n\nexport const idText = dialog.add(\"edittext\", undefined, undefined, {\n  name: \"idText\"\n});\nidText.text = \"\";\n(idText.preferredSize as Dimension).width = 80;\n\n// GROUP2\n// ======\nexport const confirmGroup = dialog.add(\"group\", undefined, {\n  name: \"confirmGroup\"\n});\nconfirmGroup.orientation = \"row\";\nconfirmGroup.alignChildren = [\"left\", \"center\"];\nconfirmGroup.spacing = 10;\nconfirmGroup.margins = 0;\nconfirmGroup.alignment = [\"right\", \"top\"];\n(confirmGroup.preferredSize as Dimension).height = 40;\n\nexport const ok = confirmGroup.add(\"button\", undefined, undefined, {\n  name: \"ok\"\n});\nok.text = \"Select target and OK\";\nok.justify = \"left\";\nok.alignment = [\"left\", \"center\"];\n","import {\n  isCompItem,\n  isFolderItem,\n  isFootageItem,\n  isAVLayer,\n  isFileSource,\n  isSolidSource,\n  isProperty,\n  isPropertyGroup,\n  isObject\n} from \"../typeCheck\";\nimport { getAllItems } from \"../GetEntity/getEntity\";\n\nexport const times = (\n  step: number,\n  callback: (index: number) => boolean | null | undefined | void\n): void => {\n  for (let i = 1; i <= step; i++) {\n    if (callback(i)) {\n      break;\n    } else {\n      continue;\n    }\n  }\n};\n\nexport const unselectAllItems = (): void => {\n  getAllItems().forEach(item => {\n    if (item.selected) item.selected = false;\n  });\n};\n\nexport const computeDurationWithMsec = (ms: number): string => {\n  const h = parseInt(String(Math.floor(ms / 3600000) + 100).substring(1));\n  const m = parseInt(\n    String(Math.floor((ms - h * 3600000) / 60000) + 100).substring(1)\n  );\n  const s = parseInt(\n    String(Math.round((ms - h * 3600000 - m * 60000) / 1000) + 100).substring(1)\n  );\n  return h + \":\" + m + \":\" + s;\n};\n","export const isFolderItem = (item: any): item is FolderItem => {\n  return item instanceof FolderItem;\n};\n\nexport const isCompItem = (item: any): item is CompItem => {\n  return item instanceof CompItem;\n};\n\nexport const isFootageItem = (item: any): item is FootageItem => {\n  return item instanceof FootageItem;\n};\n\nexport const isAVItem = (item: any): item is CompItem | FootageItem => {\n  return isCompItem(item) || isFootageItem(item);\n};\n\nexport const isAnyItem = (item: any): item is $T.ADBE.AnyItem => {\n  return isCompItem(item) || isFolderItem(item) || isFootageItem(item);\n};\n\nexport const isAVLayer = (layer: any): layer is AVLayer => {\n  return layer instanceof AVLayer;\n};\n\nexport const isCameraLayer = (layer: any): layer is CameraLayer => {\n  return layer instanceof CameraLayer;\n};\n\nexport const isLightLayer = (layer: any): layer is LightLayer => {\n  return layer instanceof LightLayer;\n};\n\nexport const isShapeLayer = (layer: any): layer is ShapeLayer => {\n  return layer instanceof ShapeLayer;\n};\n\nexport const isTextLayer = (layer: any): layer is TextLayer => {\n  return layer instanceof TextLayer;\n};\n\nexport const isAnyLayer = (layer: any): layer is $T.ADBE.AnyLayer => {\n  return (\n    isAVLayer(layer) ||\n    isCameraLayer(layer) ||\n    isLightLayer(layer) ||\n    isShapeLayer(layer) ||\n    isTextLayer(layer)\n  );\n};\n\nexport const isFileSource = (source: any): source is FileSource => {\n  return source instanceof FileSource;\n};\n\nexport const isSolidSource = (source: any): source is SolidSource => {\n  return source instanceof SolidSource;\n};\n\nexport const isPlaceholderSource = (\n  source: any\n): source is PlaceholderSource => {\n  return source instanceof PlaceholderSource;\n};\n\nexport const isAnySource = (\n  source: any\n): source is FileSource | SolidSource | PlaceholderSource => {\n  return (\n    isFileSource(source) || isSolidSource(source) || isPlaceholderSource(source)\n  );\n};\n\nexport const isProperty = (property: any): property is Property => {\n  return property instanceof Property;\n};\n\nexport const isPropertyGroup = (property: any): property is PropertyGroup => {\n  return property instanceof PropertyGroup;\n};\n\nexport const isMaskPropertyGroup = (\n  property: any\n): property is MaskPropertyGroup => {\n  return property instanceof MaskPropertyGroup;\n};\n\nexport const isAnyProperty = (\n  property: any\n): property is $T.ADBE.AnyProperty => {\n  return (\n    isProperty(property) ||\n    isPropertyGroup(property) ||\n    isMaskPropertyGroup(property)\n  );\n};\n\nexport const isTextDocument = (value: any): value is TextDocument => {\n  return value instanceof TextDocument;\n};\n\nexport const isShape = (value: any): value is Shape => {\n  return value instanceof Shape;\n};\n\nexport const isMarkerValue = (value: any): value is MarkerValue => {\n  return value instanceof MarkerValue;\n};\n\nexport const isBasicPropertyValue = (\n  value: any\n): value is $T.Mat.BasicValue => {\n  const isBasicPropertyArray =\n    isArray(value) &&\n    ((value.length === 2 && isNumber(value[0]) && isNumber(value[1])) ||\n      (value.length === 3 &&\n        isNumber(value[0]) &&\n        isNumber(value[1]) &&\n        isNumber(value[2])) ||\n      (value.length === 4 &&\n        isNumber(value[0]) &&\n        isNumber(value[1]) &&\n        isNumber(value[2]) &&\n        isNumber(value[3])));\n  return (\n    isUndefined(value) ||\n    isBoolean(value) ||\n    isNumber(value) ||\n    isBasicPropertyArray\n  );\n};\n\nexport const isPropertyValue = (value: any): value is PropertyValue => {\n  return (\n    isTextDocument(value) ||\n    isShape(value) ||\n    isMarkerValue(value) ||\n    isBasicPropertyValue(value)\n  );\n};\n\nexport const isObject = (data: any): data is { [key: string]: any } => {\n  return Object.prototype.toString.call(data) === \"[object Object]\";\n};\n\nexport const isArray = (data: any): data is any[] => {\n  return Array.isArray(data);\n};\n\nexport const isFunction = (data: any): data is Function => {\n  return typeof data === \"function\";\n};\n\nconst posinf = Number.POSITIVE_INFINITY;\nconst neginf = Number.NEGATIVE_INFINITY;\n\nexport const isNumber = (data: any): data is number => {\n  return typeof data === \"number\" && data > neginf && data < posinf;\n};\n\nexport const isUndefined = (data: any): data is undefined => {\n  return data === undefined;\n};\n\nexport const isBoolean = (data: any): data is Boolean => {\n  return data === false || data === true;\n};\n\nexport const isString = (data: any): data is string => {\n  return typeof data === \"string\";\n};\n","import { getActiveItem, getActiveCompItem } from \"./getEntity\";\n\nexport const getSelectedItems = (): $T.ADBE.AnyItem[] | null => {\n  const items = app.project.selection;\n  return items[0] ? (items as $T.ADBE.AnyItem[]) : null;\n};\n\nexport const getSelectedLayers = (\n  compItem: CompItem\n): $T.ADBE.AnyLayer[] | null => {\n  const layers = compItem.selectedLayers as $T.ADBE.AnyLayer[];\n  return layers[0] ? layers : null;\n};\n\nexport const getSelectedProperties = (\n  compItem: CompItem\n): $T.ADBE.AnyProperty[] | null => {\n  const properties = compItem.selectedProperties as\n    | $T.ADBE.AnyProperty[]\n    | null;\n  return properties && properties[0] ? properties : null;\n};\n\nexport const getSelectedPropertiesFromActive = ():\n  | $T.ADBE.AnyProperty[]\n  | null => {\n  const compItem = getActiveCompItem();\n  return compItem && getSelectedProperties(compItem);\n};\n\nexport const getSelectedLayersFromActive = (): $T.ADBE.AnyLayer[] | null => {\n  const compItem = getActiveCompItem();\n  return compItem && getSelectedLayers(compItem);\n};\n","import \"../../polyfill/array/forEach\";\nimport * as win from \"./ui\";\nimport { getSelectedItems } from \"../../utils/GetEntity/getSelectedEntity\";\nimport { times } from \"../../utils/Javascript/general\";\nimport { isAVItem, isAVLayer } from \"../../utils/typeCheck\";\n\nconst main = () => {\n  // event\n  // ======\n\n  let sourceItem: AVItem;\n\n  win.setButton.onClick = () => {\n    const items = getSelectedItems();\n\n    if (!items) {\n      return;\n    }\n\n    if (!isAVItem(items[0])) {\n      alert(\"No avitem is selected.\");\n      return;\n    }\n\n    sourceItem = items[0];\n    win.idText.text = sourceItem.id.toString();\n  };\n\n  win.ok.onClick = () => {\n    const items = getSelectedItems();\n    if (!items) {\n      return;\n    }\n    const targetItem = items[0];\n\n    if (!isAVItem(targetItem)) {\n      alert(\"No avitem is selected.\");\n      return;\n    }\n    if (!isAVItem(sourceItem)) {\n      alert(\"No avitem is selected.\");\n      return;\n    }\n\n    const compItems = sourceItem.usedIn;\n\n    compItems.forEach((compItem, i) => {\n      times(compItem.numLayers, i => {\n        const layer = compItem.layer(i);\n        if (!isAVLayer(layer)) return;\n        if (layer.source !== sourceItem) return;\n        layer.replaceSource(targetItem, false);\n      });\n    });\n  };\n\n  // ======\n\n  win.dialog.layout.layout();\n  win.dialog.layout.resize();\n};\n\nmain();\n"],"names":["Array","prototype","forEach","callback","thisArg","TypeError","array","i","l","length","call","dialog","globalThis","text","orientation","alignChildren","spacing","margins","setButton","add","undefined","name","idText","preferredSize","width","confirmGroup","alignment","height","ok","justify","times","step","isCompItem","item","CompItem","isFootageItem","FootageItem","isAVItem","isAVLayer","layer","AVLayer","getSelectedItems","items","app","project","selection","main","sourceItem","win","onClick","alert","id","toString","targetItem","compItems","usedIn","compItem","numLayers","source","replaceSource","layout","resize"],"mappings":"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"}